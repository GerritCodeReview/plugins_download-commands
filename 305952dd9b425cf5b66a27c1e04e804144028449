{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "61a2401e_00586aee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2025-12-15T12:30:44Z",
      "side": 1,
      "message": "FWICT the GERRIT_API_VERSION cannot be correlated to the expected GERRIT_API_VERSION like you can with in-tree build where the api version is taken from the specified version in the gerrit source-tree.",
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66ea1782_9d4d3091",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2025-12-15T12:30:44Z",
      "side": 1,
      "message": "How is this version correlated to the plugin version?",
      "range": {
        "startLine": 1,
        "startChar": 43,
        "endLine": 1,
        "endChar": 61
      },
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d42b5b4b_4ee56fa6",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2025-12-15T12:30:44Z",
      "side": 1,
      "message": "Unrelated change.\nCommit message speaks only of `gerrit_plugin.bzl`",
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2111ec32_78e728ae",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2025-12-16T12:09:52Z",
      "side": 1,
      "message": "The gerrit_plugin rule also generates the manifest contained in the plugin\u0027s jar. Part of that manifest is the Gerrit API version used during the build. There are now two cases:\n\n- standalone build: The build uses the published `gerrit-plugin-api`, which is provided by the `bazlets` library. Thus, in this case, the version in the manifest has to match the version of `gerrit-plugin-api` provided by `bazlets`\n- in-tree build: The build uses the Gerrit API as provided in the checked out Gerrit version. In this case we can\u0027t use the version-String as provided by `bazlets`, but have to get the version from the Gerrit core project.\n\nPreviously, the `gerrit_plugin` rule in `gerrit` an `bazlets` were slightly different with the major difference being how the Gerrit API version was accessed. Now, that both versions of the rule were merged, this is not as easy anymore. Thus, I added an additional parameter to the rule: `gerrit_api_version`. Thus, since this change transitions to the rule provided by `bazlets`, I added this parameter and set it to the version provided by Gerrit, which it does using a bazel repository. This is required, since the default would be the version set in `bazlets`, which is currently `3.11.0`, which is not correct for an in-tree build as used for this plugin.",
      "parentUuid": "66ea1782_9d4d3091",
      "range": {
        "startLine": 1,
        "startChar": 43,
        "endLine": 1,
        "endChar": 61
      },
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "352b83f0_098ef41c",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2025-12-16T13:04:08Z",
      "side": 1,
      "message": "Ah so `@gerrit_api_version//:version.bzl` references a \"local\" (?) bazel repository that is available for in-tree builds?\nAm I understanding correctly that:\n* If you don\u0027t maintain release-branches for your plugin it makes sense to have this setup, at least for the master branch, always build in-tree and let the \"plugin-version\" be dependent on the api-version of the \"surrounding\" tree.\n\n* But if you cut a release-branch, and/or want to use standalone builds, for the plugin it makes sense to hard-code `GERRIT_API_VERSION`, e.g. `branch\u003dstable-3.12, GERRIT_API_VERSION\u003d3.12.0`, branch\u003dstable-3.13, GERRIT_API_VERSION\u003d3.13.0`\n\n?",
      "parentUuid": "2111ec32_78e728ae",
      "range": {
        "startLine": 1,
        "startChar": 43,
        "endLine": 1,
        "endChar": 61
      },
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "24808bdf_40ca9735",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1014252
      },
      "writtenOn": "2025-12-16T13:04:32Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "d42b5b4b_4ee56fa6",
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95dc97bf_311642d2",
        "filename": "BUILD",
        "patchSetId": 1
      },
      "lineNbr": 1,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2025-12-16T13:30:20Z",
      "side": 1,
      "message": "\u003e Ah so @gerrit_api_version//:version.bzl references a \"local\" (?) bazel repository that is available for in-tree builds?\n\nYes, `@` marks a repository in bazel, i.e. `@gerrit_api_version` is a repository that is created by a repository rule, which in this case just writes the version from a constant into a file into that repository. The reason for that is, that bazel doesn\u0027t have rules that can output values in memory, i.e. you always have to create some file-based artifact and that we want to have the constant where we define the version available in the MODULE.bazel file, since we need it there. In MODULE.bazel we can\u0027t however load other files or define rules. We can only create repositories. Thus, we use that way to provide a version that we only define once in source for all other build rules that need it.\n\n\u003e Am I understanding correctly that: ...\n\nYes and no. The version here will only influence what is written into the manifest, it doesn\u0027t influence which API will be used [1].\n\nFor the actual API, the build checks whether it is an in-tree or a standalone build. In the former case, it will load the API from Gerrit core (i.e. the current working tree), otherwise it will use the published version referenced in bazlets [2]. This is basically the same behaviour as before.\n\n[1] https://gerrit.googlesource.com/bazlets/+/refs/changes/01/535901/2/gerrit_plugin.bzl#76\n\n[2] https://gerrit.googlesource.com/bazlets/+/refs/changes/01/535901/2/gerrit_plugin.bzl#54",
      "parentUuid": "352b83f0_098ef41c",
      "range": {
        "startLine": 1,
        "startChar": 43,
        "endLine": 1,
        "endChar": 61
      },
      "revId": "305952dd9b425cf5b66a27c1e04e804144028449",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}